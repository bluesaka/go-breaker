## 服务熔断
微服务架构中，服务的依赖和调用关系错综复杂。常见的级联调用，如服务A --> 服务B --> 服务C，
如果此时服务C有问题，会导致服务B拿不到响应结果，进而服务A也拿不到相应结果，
而后不断重新请求服务C，导致服务C出现大量请求积压，进而资源耗尽，影响到整个服务链路，形成雪崩效应。
为了解决雪崩效应，需要建立有效的服务容错机制，可以做服务的集群和重试机制，提供服务的可用性，当服务出错时，可以设置不同的失败策略。
在微服务中，经常会使用限流、降级、熔断等措施。限流降级属于服务端行为，熔断属于客户端行为。

### 熔断器
熔断机制类似于我们日常生活的电路保护器，但电路超负荷运行时，电路保险丝会自动断开，从而保护电路中的电器不受损害。
服务治理中的熔断机制，指的是发起服务调用时，如果被调用方返回的错误率超过一定的阈值，那么后续不会请求，而是在调用方直接返回错误。

### 熔断器状态
- 关闭状态，正常调用服务
- 开启状态，拒绝调用服务
- 半开状态，限制部分请求调用

### 熔断器状态转移
- 关闭状态下，当失败满足一定条件时，更新为开启状态
- 开启状态下，当过了规定时间，更新为半开状态
- 半开状态下，当出现失败，则更新为开启状态
- 半开状态下，当所有请求都成功且达到规定数量时，更新为关闭状态

### 熔断策略
- 失败数
- 连续失败数
- 失败率

### 熔断机制
```

                                 switch to open
        +-----------------------------------------------------------------------+
        |                                                                       |
        |                                                                       v
+----------------+                   +----------------+      Probe      +----------------+
|                |                   |                |<----------------|                |
|                |   Probe succeed   |                |                 |                |
|     Closed     |<------------------|    HalfOpen    |                 |      Open      |
|                |                   |                |   Probe failed  |                |
|                |                   |                |---------------->|                |
+----------------+                   +----------------+                 +----------------+

```
